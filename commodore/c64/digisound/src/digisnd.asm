100 ;COVOX DIGITIZED SPEECH DEMO
110 ;
120 ;(C) 1989 STEVE GOLDSMITH
130 ;
140 ;
150 R6510 = $01 ;INPUT/OUTPUT REGISTER
160 ;
170 ;CIA #1 CHIP
180 ;
190 PORTA1 = $DC00 ;CIA #1 DATA PORT REGISTER A
200 DDRA1 = $DC02 ;CIA #1 DATA DIRECTION REGISTER PORT A
210 ICR1 = $DC0D ;INTERRUPT CONTROL REGISTER
220 ;
230 ;CIA #2 CHIP
240 ;
250 PORTA2 = $DD00 ;CIA #2 DATA PORT REGISTER A
260 DDRA2 = $DD02 ;CIA #2 DATA DIRECTION REGISTER PORT A
270 TIMEA2 = $DD04 ;CIA #2 TIMER LO BYTE
280 CRA2 = $DD0E ;CIA #2 CONTROL REGISTER
290 ICR2 = $DD0D ;INTERRUPT CONTROL REGISTER
300 ;
310 ;VIC CHIP & OTHER VIDEO
320 ;
330 VICREG = $D000 ;VIC CHIP
340 BITCOL = $5C00 ;BITMAP COLOR MEMORY
350 SPPTR = $5FF8 ;SPRITE POINTERS
360 TEXTSC = $8000 ;TEXT SCREEN
370 COLORM = $D800 ;TEXT COLOR RAM
380 TXTDAT = $8400 ;START OF TEXT DATA
390 GETTXT = $B0 ;INDIRECT INDEX TO TEXT DATA
400 ;
410 ;SID CHIP
420 ;
430 SIDREG = $D400 ;SID CHIP
440 VOLUME = $D418 ;SID MASTER VOLUME CONTROL
450 ;
460 ;PLAY BACK VARIBLES
470 ;
480 SAMPLE = $F7 ;WHERE SOUND IS RECORDED TO OR PLAYED FROM
490 FBYTE = $F9 ;FREQ BYTE
500 MAXBLK = $FA ;MAX # OF BLOCKS YOU CAN RECORD
510 MS5 = $FB ;5 MICRO SEC DELAY       NUMBER
520 BITCNT = $FC ;BIT COUNT
530 ;
540 ;KERNAL ROUTINES AND VARIABLES
550 ;
560 LOAD = $FFD5 ;LOAD RAM
570 SETLFS = $FFBA ;SET LOGICAL FILE #
580 SETNAM = $FFBD ;SET FILE NAME
590 IRQVEC = $0314 ;IRQ VECTOR
600 ;
610 * = $C000 ;START OF PROGRAM
611 ;
612 :FILE @0:DIGISND.EXE,8
620 ;
630 ;INITILIZE PROGRAM
640 ;
650 JSR LOADAL ;LOAD ALL DATA FILES
655 INITAPP = *
660 JSR CLRSID ;CLEAR SID CHIP
670 JSR INITDT ;INIT DIR TOGGLES
680 JSR INITXY ;INIT SPRITE X,Y DIRS
690 JSR INITSV ;INIT VARIOUS SPRITE VARS
700 JSR INITSB ;INITILIZE SPRITE BOUNDRIES
710 JSR INITC2 ;INIT CIA #2 TIMER
720 JSR SETGR1 ;SET GRAPHICS MODE
730 JSR INITTS ;INITILIZE TEXT SCREEN
740 JSR INITRI ;INITILIZE RASTER IRQ
750 JSR DISP1 ;DISPLAY SPRITES
760 JSR INITED ;INITILIZE EVENT DISPATCH
770 JMP MAIN
780 ;
790 ;MAIN LOOP
800 ;
810 MAIN = *
820 JUMP1 JSR SPMOVE
830 JSR SOUND1
840 JSR EVENT ;EVENT DISPATCH
850 LDA LINCNT
860 CMP #11 ;LAST TEXT LINE
870 BNE JUMP1
910 JMP INITAPP
920 ;
930 ;PLAY SOUND FROM MEMORY
940 ;
950 PLAY SEI ;DISABLE IRQ INTERRUPT
960 JSR CLRSID ;CLEAR SID
970 LDA #$00
980 STA VICREG+26 ;DISABLE VIC IRQS
990 STA VICREG+21 ;DISABLE SPRITES
1000 LDA VICREG+17
1010 AND %11101111 ;BLANK SCREEN
1020 STA VICREG+17
1030 LDX #$00 ;BYTE COUNTER
1040 REPEAT1 EOR MS5 ;-
1050 INC VICREG+32 ; - 15 MICRO SEC DELAY
1060 INC VICREG+32 ;-
1070 LOOP1 LDY #$08 ;BIT COUNTER
1080 DOWHILE1 ROL $FFFF,X ;THIS IS A SELF MODIFING ADDRESS
1090 IF1 BCC THEN1
1100 AMP LDA #$0F ;SELF MODIFING  ADDRESS
1110 JMP ELSE1
1120 THEN1 NOP ;MICRO SEC DELAY
1130 LDA #$00
1140 ELSE1 STA VOLUME
1150 DEY
1160 BEQ ENDDO1
1170 NOP ;-
1180 NOP ; -
1190 NOP ;  -
1200 NOP ;   -
1210 NOP ;    -
1220 NOP ;    - 20 MICRO SEC DELAY
1230 NOP ;   -
1240 NOP ;  -
1250 NOP ; -
1260 NOP ;-
1270 ENDIF1 JMP DOWHILE1
1280 ENDDO1 INX
1290 UNTIL1 BNE REPEAT1
1300 DEC MAXBLK
1310 IF2 BEQ THEN2
1320 INC DOWHILE1+2
1330 GOTO1 JMP LOOP1 ;GOTO LOOP1
1340 THEN2 JSR KERIN
1350 JSR BASIN
1360 LDA VICREG+17
1370 ORA %00010000 ;TURN SCREEN ON
1380 STA VICREG+17
1390 LDA %00000001
1400 STA VICREG+26 ;ENABLE RASTER IRQ
1410 LDA %11111111
1420 STA VICREG+21 ;ENABLE SPRITES
1430 LDA #$00 ;BLACK
1440 STA VICREG+32 ;BORDER COLOR
1450 CLI ;RESTORE IRQ INTERRUPT
1460 RTS ;RETURN
1470 ;
1480 ;LOAD ALL FILES
1490 ;
1500 LOADAL LDA <FNAME
1510 STA GETTXT
1520 LDA >FNAME
1530 STA GETTXT+1 ;START OF FILE NAME
1540 LDA #$00
1550 STA MS5 ;FILE COUNTER
1560 REPEAT21 LDA #$01 ;LOGICAL FILE #
1570 LDX DEVICE ;DEVICE #
1580 LDY #$01 ;LOAD FILE AT ORIGIN
1590 JSR SETLFS ;SET LOGICAL FILE #
1600 LDA #$10 ;FILE NAME LENGTH
1610 LDX GETTXT ;FILE NAME LO BYTE
1620 LDY GETTXT+1 ;FILE NAME HI BYTE
1630 JSR SETNAM ;SET FILE NAME
1640 LDA #$0 ;SET FLAG FOR LOAD
1650 JSR LOAD ;LOAD FILE
1660 LDA GETTXT
1670 CLC
1680 ADC #$10
1690 STA GETTXT ;SET FOR NEXT NAME
1700 LDA #$00
1710 ADC GETTXT+1 ;ADD CARRY BIT
1720 STA GETTXT+1
1730 INC MS5 ;MS5 = MS5+1
1740 LDA MS5
1750 CMP #$08
1760 BNE REPEAT21 ;UNTIL MS5=8
1770 RTS
1780 ;
1790 ;SET VIC BANK AND SET BIT MAP MODE
1800 ;
1810 SETGR1 LDA DDRA2
1820 ORA %00000011
1830 STA DDRA2 ;SET BITS 0 & 1 TO OUTPUTS ON PORTA2
1840 LDA PORTA2
1850 AND %11111100
1860 ORA %00000010
1870 STA PORTA2 ;VIC BANK 1 ($4000-$7FFF)
1880 LDA %01111000
1890 STA VICREG+24 ;SCREEN BLOCK 7 ($5C00-$5FFF) & BIT MAP BLOCK 1 ($6000-
$7FFF)
1900 LDA %00001000
1910 STA VICREG+22 ;40 COLUMNS
1920 LDA VICREG+17
1930 ORA %00111000
1940 STA VICREG+17 ;ENABLE BIT MAP MODE
1950 RTS
1960 ;
1970 ;INITIALIZE SPRITE DIRECTION TOGGLES, COLORS AND FIRST FRAME
1980 ;
1990 INITDT LDX #$00 ;X=0
2000 REPEAT2 LDA #$00 ;REPEAT
2010 STA XDIR,X ;0 X DIRECTIONS
2020 STA YDIR,X ;0 Y DIRECTIONS
2030 STA ROTDIR,X ;0 ROTATION DIRECTIONS
2040 STA SPCOLOR,X ;0 COLOR SEQUENCE
2050 LDA #92 ;FIRST FRAME
2060 STA SPPTR,X ;SET SPRITE POINTER
2070 LDA #$02 ;RED
2080 STA VICREG+39,X ;SET BIT PAIR 10
2090 INX ;X=X+1
2100 CPX #$08
2110 UNTIL2 BNE REPEAT2 ;UNTIL X = 8
2120 RTS
2130 ;
2140 ;INITIALIZE SPRITE X & Y DIRECTIONS
2150 ;
2160 INITXY LDX #$00
2170 STX VICREG+16 ;SET MSB SPRITE X
2180 REPEAT3 LDA #160 ;REPEAT
2190 STA VICREG,X ;INIT X DIR
2200 INX ;X=X+1
2210 LDA #140
2220 STA VICREG,X ;INIT Y DIR
2230 INX ;X=X+1
2240 CPX #$10
2250 UNTIL3 BNE REPEAT3
2260 RTS
2270 ;
2280 ;INITIALIZE VARIOUS SPRITE RELATED VARIABLES
2290 ;
2300 INITSV LDA #$06 ;BLUE
2310 STA VICREG+37 ;BIT PAIR 01 COLOR
2320 LDA #$01 ;WHITE
2330 STA VICREG+38 ;BIT PAIR 11 COLOR
2340 LDA %11111111
2350 STA VICREG+28 ;SET MULTICOLOR MODE
2360 STA VICREG+21 ;TURN ON SPRITES
2370 LDA %10101010
2380 STA VICREG+27 ;BACK GRUOND PRIORITY
2390 LDA #$00 ;BLACK
2400 STA VICREG+32 ;BORDER COLOR
2410 LDA #$00
2420 STA COLSEQ
2430 STA COLSAV
2440 LDA #$01
2450 STA SNDTGL ;SET SOUND TOGGLE
2460 LDA #$FF
2470 STA MTIMER ;SET MTIMER
2480 LDA #$03
2490 STA RTIMER ;SET RTIMER
2500 RTS
2510 ;
2520 ;INITIALIZE CIA #2 TIMER
2530 ;
2540 INITC2 LDA %01111111
2550 STA ICR2 ;SHUT OFF CIA #2 IRQS
2560 STA ICR1 ;SHUT OFF CIA #1 IRQS
2570 LDA #$02
2580 STA TIMEA2+1 ;SET TIMER A HI
2590 LDA #$FF
2600 STA TIMEA2 ;SET TIMER A LO
2610 LDA %00010001
2620 STA CRA2 ;START TIMER
2630 RTS ;RETURN
2640 ;
2650 ;SPRITE MOVEMENT MODULE
2660 ;
2670 SPMOVE LDA ICR2
2680 STA TICR2 ;TEMP ICR2
2690 AND %00000001
2700 IF4 BEQ THEN4
2710 DEC MTIMER ;MTIMER=MTIMER-1
2720 IF5 BNE THEN5
2730 JSR MOVALL ;MOVE ALL SPRITES
2740 JSR FSCRL ;FINE SCROLL DIGISOUND
2750 THEN5 DEC RTIMER ;RTIMER=RTIMER-1
2760 IF6 BNE THEN4
2770 JSR ROTALL ;ROTATE ALL SPRITES
2780 THEN4 RTS ;RETURN
2790 ;
2800 ;MOVE ALL 8 SPRITES AT ONCE
2810 ;
2820 MOVALL LDX #$00
2830 STX SCOUNT
2840 REPEAT6 LDA VICREG+17
2850 BPL REPEAT6
2860 REPEAT4 JSR MLEFT ;REPEAT
2870 JSR MRIGHT ;MOVE RIGHT
2880 JSR MUP
2890 JSR MDOWN
2900 INC SCOUNT ;SCOUNT=SCOUNT+1
2910 LDX SCOUNT
2920 CPX #$08
2930 UNTIL4 BNE REPEAT4 ;UNTIL X=8
2940 LDA #$02
2950 STA MTIMER
2960 JSR COLLIN ;COLOR DIGISOUND
2970 RTS
2980 ;
2990 ;ROTATE ALL 8 SPRITES AT ONCE
3000 ;
3010 ROTALL LDX #$00
3020 STX SCOUNT
3030 REPEAT7 LDA VICREG+17
3040 BPL REPEAT7
3050 REPEAT5 JSR ROTSP ;REPEAT
3060 INC SCOUNT ;SCOUNT=SCOUNT+1
3070 LDX SCOUNT
3080 CPX #$08
3090 UNTIL5 BNE REPEAT5 ;UNTIL X=8
3100 LDA #$07
3110 STA RTIMER
3120 JSR SRLTXT ;SCROLL TEXT LINE
3130 RTS
3140 ;
3150 ;FINE SCROLL 'DIGISOUND'
3160 ;
3170 FSCRL LDA XSDIR
3180 BNE THEN49
3190 INC XSCRL
3200 LDA XSCRL
3210 CMP #$07
3220 IF48 BNE THEN48
3230 STA XSDIR ;TOGGLE DIRECTION
3240 THEN49 DEC XSCRL
3250 LDA XSCRL
3260 BNE THEN48
3270 STA XSDIR ;TOGGLE DIRECTION
3280 THEN48 RTS
3290 ;
3300 ; INITILIZE SPRITE BOUNDRIES
3310 ;
3320 INITSB LDA #130
3330 STA UBOUND
3340 LDA #150
3350 STA DBOUND
3360 RTS
3370 ;
3380 ;MOVE LEFT IF XDIR = 1
3390 ;
3400 MLEFT LDX SCOUNT ;X=SCOUNT
3410 LDA XDIR,X ;A=XDIR+X
3420 IF7 BEQ THEN7
3430 LDA #$01 ;A=1
3440 CPX #$00
3450 DOWHILE2 BEQ ENDDO2
3460 ASL A ; A=A*2
3470 DEX
3480 JMP DOWHILE2
3490 ENDDO2 TAY ;SAVE SPRITE # BIT
3500 AND VICREG+16 ;TEST MSB SPRITE X
3510 IF8 BEQ THEN8
3520 LDA SCOUNT
3530 ASL A ;A=SCOUNT*2
3540 TAX ;X=A
3550 LDA VICREG,X
3560 IF9 BNE THEN9 ;IF SPRITE SEEM
3570 TYA ;GET SPRITE # BIT
3580 EOR %11111111 ;REVERSE ALL BITS
3590 AND VICREG+16 ;TURN OFF MSB SPRITE X
3600 STA VICREG+16
3610 THEN9 DEC VICREG,X
3620 THEN7 RTS
3630 THEN8 LDA SCOUNT
3640 ASL A ;A=SCOUNT*2
3650 TAX ;X=A
3660 LDA VICREG,X
3670 CMP #20 ;LEFT EDGE OF SCREEN
3680 IF10 BNE THEN10
3690 LDA #$00
3700 LDX SCOUNT ;X=SCOUNT
3710 STA XDIR,X ;CHANGE DIR
3720 STA ROTDIR,X ;ROTDIR+X=0
3730 STA SNDTGL
3740 LDY TIMEA2
3750 IF22 BPL THEN22
3760 STA YDIR,X
3770 THEN22 RTS
3780 THEN10 DEC VICREG,X
3790 RTS
3800 ;
3810 ;MOVE RIGHT IF XDIR = 0
3820 ;
3830 MRIGHT LDX SCOUNT
3840 LDA XDIR,X ;A=XDIR+X
3850 IF11 BNE THEN11
3860 LDA #$01 ;A=1
3870 CPX #$00
3880 DOWHILE3 BEQ ENDDO3 ;DOWHILE X<>0
3890 ASL A ;A=A*2
3900 DEX ;X=X-1
3910 JMP DOWHILE3
3920 ENDDO3 TAY ;SAVE SPRITE # BIT
3930 AND VICREG+16 ;TEST MSB SPRITE X
3940 IF12 BNE THEN12
3950 LDA SCOUNT
3960 ASL A ;A=SCOUNT*2
3970 TAX ;X=A
3980 LDA VICREG,X
3990 CMP #$FF ;SPRITE SEEM
4000 IF13 BNE THEN13 ;IF SPRITE SEEM
4010 TYA ;GET SPRITE # BIT
4020 ORA VICREG+16 ;TURN ON MSB SPRITE X
4030 STA VICREG+16
4040 THEN13 INC VICREG,X
4050 THEN11 RTS
4060 THEN12 LDA SCOUNT ;A=SCOUNT
4070 ASL A ;A=A*2
4080 TAX ;X=A
4090 LDA VICREG,X ;A=VICREG+X
4100 CMP #66 ;RIGHT EDGE OF SCREEN
4110 IF14 BNE THEN14
4120 LDA #$01 ;A=1
4130 LDX SCOUNT ;X=SCOUNT
4140 STA XDIR,X ;XDIR+X=1
4150 STA ROTDIR,X ;ROTDIR+X=1
4160 LDA #$00
4170 STA SNDTGL
4180 RTS
4190 THEN14 INC VICREG,X ;VICREG+X=VICREG+X+1
4200 RTS
4210 ;
4220 ;MOVE UP IF YDIR = 1
4230 ;
4240 MUP LDX SCOUNT ;X=SCOUNT
4250 LDA YDIR,X ;A=YDIR+X
4260 IF15 BEQ THEN15
4270 LDA SCOUNT
4280 ASL A ;A=SCOUNT*2
4290 TAX ;X=A
4300 INX ;X=X+1
4310 LDA VICREG,X ;A=VICREG+X
4320 CMP UBOUND
4330 IF16 BCS THEN16
4340 LDA #$00 ;A=0
4350 LDX SCOUNT ;X=SCOUNT
4360 STA YDIR,X ;YDIR+X=0
4370 STA ROTDIR,X
4380 THEN15 RTS
4390 THEN16 DEC VICREG,X
4400 RTS
4410 ;
4420 ;MOVE DOWN IF YDIR = 0
4430 ;
4440 MDOWN LDX SCOUNT ;X=SCOUNT
4450 LDA YDIR,X ;A=YDIR+X
4460 IF17 BNE THEN17
4470 LDA SCOUNT
4480 ASL A ;A=SCOUNT*2
4490 TAX ;X=A
4500 INX ;X=X+1
4510 LDA VICREG,X ;A=VICREG+X
4520 CMP DBOUND
4530 IF18 BCC THEN18
4540 LDA #$01 ;A=1
4550 LDX SCOUNT ;X=SCOUNT
4560 STA YDIR,X ;YDIR+X=0
4570 STA ROTDIR,X
4580 LDY TIMEA2
4590 IF25 BPL THEN25
4600 STA XDIR,X
4610 THEN25 = *
4620 THEN17 RTS
4630 THEN18 INC VICREG,X
4640 RTS
4650 ;
4660 ;ROTATE SPRITE: 1=LEFT, 0=RIGHT
4670 ;
4680 ROTSP LDX SCOUNT ;X=SCOUNT
4690 LDA ROTDIR,X ;A=ROTDIR+X
4700 IF19 BEQ THEN19
4710 LDA SPPTR,X ;A=SPPTR+X
4720 CMP #92 ;FIRST SPRITE
4730 IF20 BNE THEN20
4740 LDA #111
4750 STA SPPTR,X
4760 LDA #19
4770 STA SPCOLOR,X
4780 RTS
4790 THEN20 DEC SPPTR,X
4800 DEC SPCOLOR,X
4810 LDA SPCOLOR,X
4820 TAX
4830 LDA SPCOL1,X
4840 STA VICREG+38
4850 RTS
4860 THEN19 LDA SPPTR,X
4870 CMP #111
4880 IF21 BNE THEN21
4890 LDA #92
4900 STA SPPTR,X
4910 LDA #$00
4920 STA SPCOLOR,X
4930 RTS
4940 THEN21 INC SPPTR,X
4950 INC SPCOLOR,X
4960 LDA SPCOLOR,X
4970 TAX
4980 LDA SPCOL1,X
4990 STA VICREG+38
5000 RTS
5010 ;
5020 ;INCREASE VERTICAL SPRITE BOUNDRIES BY 7 PIXELS
5030 ;
5040 INCSPB LDA UBOUND
5050 SEC
5060 SBC #7
5070 STA UBOUND
5080 LDA DBOUND
5090 CLC
5100 ADC #7
5110 STA DBOUND
5120 RTS
5130 ;
5140 ;SOUND EFFECT
5150 ;
5160 SOUND1 LDA SNDTGL
5170 IF23 BNE THEN23
5180 LDA #$00
5190 STA SIDREG+5 ;SET ATTACK/DECAY
5200 LDA #$98
5210 STA SIDREG+6 ;SET SUSTAIN/RELEASE
5220 LDA TIMEA2 ;PSUEDO RANDOM #
5230 STA SIDREG ;SET LO FREQ
5240 STA SIDREG+1 ;SET HI FREQ
5250 LDA %10000001
5260 STA SIDREG+4 ;SET RANDOM NOISE AND GATE BIT
5270 LDA #$08
5280 STA VOLUME
5290 LDA #$01
5300 STA SNDTGL ;SET SOUND TOGGLE
5310 THEN23 LDA RTIMER
5320 CMP #$01
5330 IF24 BNE THEN24
5340 LDA %10000000
5350 STA SIDREG+4 ;START RELEASE
5360 THEN24 RTS
5370 ;
5380 ;INITILIZE RASTER INTERRUPT
5390 ;
5400 INITRI SEI
5410 LDA %01111111
5420 STA ICR1 ;SHUT OFF CIA #1 IRQS
5430 LDA %00000001
5440 STA VICREG+26 ;ENABLE RASTER IRQ
5450 LDA VICREG+17
5460 AND %01111111
5470 STA VICREG+17 ;CLEAR RATSER BIT 8
5480 LDA #49
5490 STA VICREG+18 ;SET LOW RASTER BYTE
5500 LDA <SETGR2
5510 STA IRQVEC ;SET IRQ LO
5520 LDA >SETGR2
5530 STA IRQVEC+1 ;SET IRQ HI
5540 LDA #$00
5550 STA XSCRL ;0 X SCROLL REG
5560 STA XSDIR ;0 DIR TOGGLE
5570 CLI ;ENABLE IRQ
5580 RTS ;RETURN
5590 ;
5600 ;RASTER GRAPHIC MODE CHANGE 2
5610 ;
5620 SETGR2 LDA VICREG+17
5630 AND %01011111
5640 STA VICREG+17 ;DISABLE BIT MAP MODE & 0 RASTER BIT 8
5650 LDA PORTA2
5660 AND %11111100
5670 ORA %00000001
5680 STA PORTA2 ;VIC BANK 2 ($8000-$BFFF)
5690 LDA %00000010
5700 STA VICREG+24 ;SCREEN BLOCK 0 ($8000-$83FF) & CHARACTER SET ($8800-$8
9FF)
5710 LDA #66
5720 STA VICREG+18 ;SET RASTER LO
5730 LDA <SETGR3
5740 STA IRQVEC ;SET IRQ LO
5750 LDA >SETGR3
5760 STA IRQVEC+1 ;SET IRQ HI
5770 LDA VICREG+25
5780 STA VICREG+25 ;CLEAR LATCH
5790 PLA ;
5800 TAY  ;
5810 PLA   ;RESTORE REGISTERS
5820 TAX  ;
5830 PLA ;
5840 RTI ;RETURN FROM INTERRUPT
5850 ;
5860 ;RASTER GRAPHIC MODE CHANGE 3
5870 ;
5880 SETGR3 LDA PORTA2
5890 AND %11111100
5900 ORA %00000010
5910 STA PORTA2 ;VIC BANK 1 ($4000-$7FFF)
5920 LDA %01111000
5930 STA VICREG+24 ;SCREEN BLOCK 7 ($5C00-$5FFF) & BIT MAP BLOCK 1 ($6000-
$7FFF)
5940 LDA VICREG+17
5950 ORA %00100000
5960 AND %01111111
5970 STA VICREG+17 ;ENABLE BIT MAP MODE & 0 RASTER BIT 8
5980 LDA #74
5990 STA VICREG+18 ;SET RASTER LO
6000 LDA <SETGR4
6010 STA IRQVEC ;SET IRQ LO
6020 LDA >SETGR4
6030 STA IRQVEC+1 ;SET IRQ HI
6040 LDA VICREG+25
6050 STA VICREG+25 ;CLEAR LATCH
6060 PLA ;
6070 TAY  ;
6080 PLA   ;RESTORE REGISTERS
6090 TAX  ;
6100 PLA ;
6110 RTI ;RETURN FROM INTERRUPT
6120 ;
6130 ;RASTER GRAPHIC MODE CHANGE 4
6140 ;
6150 SETGR4 LDA VICREG+22
6160 AND %00000111
6170 STA XSTEMP ;SAVE CURRENT X SCROLL
6180 LDA VICREG+22
6190 AND %11111000
6200 ORA XSCRL
6210 STA VICREG+22
6220 LDA VICREG+17
6230 AND %01111111
6240 STA VICREG+17 ;0 RASTER BIT 8
6250 LDA #132
6260 STA VICREG+18 ;SET RASTER LO
6270 LDA <SETGR5
6280 STA IRQVEC ;SET IRQ LO
6290 LDA >SETGR5
6300 STA IRQVEC+1 ;SET IRQ HI
6310 LDA VICREG+25
6320 STA VICREG+25 ;CLEAR LATCH
6330 PLA ;
6340 TAY  ;
6350 PLA   ;RESTORE REGISTERS
6360 TAX  ;
6370 PLA ;
6380 RTI ;RETURN FROM INTERRUPT
6390 ;
6400 ;RASTER GRAPHIC MODE CHANGE 5
6410 ;
6420 SETGR5 LDA VICREG+22
6430 AND %11111000
6440 ORA XSTEMP ;RESTORE X SCROLL
6450 STA VICREG+22
6460 LDA #49
6470 STA VICREG+18 ;SET RASTER LO
6480 LDA <SETGR2
6490 STA IRQVEC ;SET IRQ LO
6500 LDA >SETGR2
6510 STA IRQVEC+1 ;SET IRQ HI
6520 LDA VICREG+25
6530 STA VICREG+25 ;CLEAR LATCH
6540 PLA ;
6550 TAY  ;
6560 PLA   ;RESTORE REGISTERS
6570 TAX  ;
6580 PLA ;
6590 RTI ;RETURN FROM INTERRUPT
6600 ;
6610 ;INITILIZE TEXT SCREEN
6620 ;
6630 INITTS LDA #$00
6640 STA VICREG+33 ;BLACK SCREEN
6650 LDA #$00
6660 STA VICREG+32 ;BLACK BORDER
6670 JSR CLRTS; CLEAR TEXT SCREEN
6680 LDA <TXTDAT
6690 STA GETTXT
6700 LDA >TXTDAT
6710 STA GETTXT+1
6720 LDA #$00
6730 STA TCSEQ
6740 RTS
6750 ;
6760 ;CLEAR TEXT SCREEN
6770 ;
6780 CLRTS LDX #$00
6790 REPEAT8 LDA #32
6800 STA TEXTSC,X
6810 LDA #$00 ;BLACK
6820 STA COLORM,X
6830 INX
6840 CPX #40
6850 UNTIL8 BNE REPEAT8
6860 REPEAT22 LDA #32
6870 STA TEXTSC,X
6880 LDA #$00 ;BLACK
6890 STA COLORM,X
6900 INX
6910 CPX #80
6920 UNTIL22 BNE REPEAT22
6930 RTS
6940 ;
6950 ;COLOR TEXT SCREEN
6960 ;SET A TO COLOR BEFORE CALLING
6970 ;
6980 COLTS LDX #0
6990 REPEAT23 STA COLORM,X
7000 INX
7010 CPX #40
7020 UNTIL23 BNE REPEAT23
7030 RTS
7040 ;
7050 ;SCROLL TEXT LINE
7060 ;
7070 SRLTXT LDA TEXTSC
7080 CMP #32
7090 BNE THEN26 ;IF A=SPACE THEN
7100 LDX #00
7110 REPEAT9 LDA TEXTSC+1,X
7120 STA TEXTSC,X
7130 INX
7140 CPX #40
7150 UNTIL9 BNE REPEAT9
7160 LDY #$00
7170 LDA (GETTXT),Y ;GET TEXT POINTER
7180 IF27 BEQ THEN28 ;IF A=0 THEN
7190 STA TEXTSC+39 ;DISPLAY 1 CHAR
7200 JSR INCSTR ;INCREMENT STRING POINTER
7210 THEN28 LDX TCSEQ
7220 CPX #44 ;LAST COLOR
7230 BNE THEN41
7240 LDX #$00 ;SET TO FIRST COLOR
7250 THEN41 LDA LCOL2,X
7260 INX
7270 STX TCSEQ
7280 JSR COLTS ;TEXT LINE COLOR
7290 THEN26 RTS
7300 ;
7310 ;INCREMENT START OF STRING POINTER
7320 ;
7330 INCSTR INC GETTXT ;GETTXT=GETTXT+1
7340 LDA GETTXT
7350 IF46 BNE THEN46
7360 INC GETTXT+1
7370 THEN46 RTS
7380 ;
7390 ;SCROLL COLOR ON 'DIGISOUND'
7400 ;
7410 COLLIN LDY #$00 ;0 LINE COUNT
7420 STY TEMPMB ;0 MAX CHARS
7430 LDA COLSAV
7440 STA COLSEQ ;LINE COLOR SEQUENCE
7450 REPEAT18 LDA TEMPMB
7460 STA MS5 ;SAVE MAX CHARS
7470 CLC
7480 ADC #40
7490 STA TEMPMB ;MAX CHARS = MAX CHARS + 40
7500 LDX COLSEQ
7510 LDA LCOL1,X ;GET COLOR
7520 LDX MS5 ;GET MAX CHARS
7530 REPEAT19 STA BITCOL+120,X
7540 INX ;CHAR COUNT = CHAR COUNT+1
7550 CPX TEMPMB
7560 BNE REPEAT19 ;UNTIL CHAR COUNT = MAX CHARS
7570 INC COLSEQ ;GET NEXT LINE COLOR
7580 LDA COLSEQ
7590 CMP #42
7600 IF42 BNE THEN42
7610 LDA #$00
7620 STA COLSEQ
7630 THEN42 INY ;LINE COUNTER
7640 CPY #$06
7650 BNE REPEAT18 ;UNTIL LINE COUNT = 6
7660 INC COLSEQ
7670 LDA COLSEQ
7680 CMP #42
7690 IF44 BNE THEN44
7700 LDA #$00
7710 STA COLSEQ
7720 THEN44 LDX COLSEQ
7730 LDA LCOL1,X
7740 LDX #$00
7750 REPEAT20 STA BITCOL+360,X
7760 INX
7770 CPX #40
7780 BNE REPEAT20
7790 LDX COLSAV
7800 INX
7810 CPX #42
7820 IF43 BNE THEN43
7830 LDX #$00
7840 THEN43 STX COLSAV
7850 RTS
7860 ;
7870 ;DISPLAY LOGO SPRITE
7880 ;
7890 DISP1 LDA #$00
7900 STA ETIMER ;0 EVENT TIMER
7910 LDA #$05
7920 STA ETIMER+1 ;0 EVENT TIMER HI
7930 LDA #$DD
7940 STA SIDREG+5 ;SET ATTACK/DECAY
7950 LDA #$02
7960 STA SIDREG+6 ;SET SUSTAIN/RELEASE
7970 LDA TIMEA2 ;PSUEDO RANDOM #
7980 STA SIDREG ;SET LO FREQ
7990 STA SIDREG+1 ;SET HI FREQ
8000 LDA #$08
8010 STA VOLUME
8020 LDA %00100001
8030 STA SIDREG+4 ;SET RANDOM NOISE AND GATE BIT
8040 REPEAT10 LDA ICR2
8050 AND %00000001
8060 BEQ REPEAT10
8070 REPEAT14 LDA VICREG+17
8080 BPL REPEAT14
8090 LDA VICREG+18
8100 STA VICREG+37
8110 LDA TIMEA2
8120 ORA %10101010
8130 STA SIDREG ;SET LO FREQ
8140 STA SIDREG+1 ;SET HI FREQ
8150 DEC ETIMER
8160 BNE REPEAT10
8170 DEC ETIMER+1
8180 UNTIL10 BNE REPEAT10
8190 LDA #$06
8200 STA VICREG+37
8210 LDA %00100000
8220 STA SIDREG+4 ;START RELEASE
8230 RTS
8240 ;
8250 ;EVENT DISPATCH INITILIZE
8260 ;
8270 INITED LDA #$00
8280 STA SEQ
8290 LDA #0
8300 STA ETIMER
8310 LDA #10
8320 STA ETIMER+1
8330 LDA #1
8340 STA ETIMER+2
8350 LDA #$00
8360 STA LINCNT ;0 LINE COUNT
8370 RTS
8380 ;
8390 ;EVENT DISPATCH
8400 ;
8410 EVENT LDA TICR2 ;TEMP ICR2
8420 AND %00000001
8430 IF29 BEQ THEN29
8440 DEC ETIMER
8450 LDA ETIMER
8460 IF30 BNE THEN29
8470 DEC ETIMER+1
8480 LDA ETIMER+1
8490 IF31 BNE THEN29
8500 DEC ETIMER+2
8510 LDA ETIMER+2
8520 IF32 BNE THEN29
8530 JSR EXEPRT ;EXECUTE PARTS
8540 THEN29 RTS
8550 ;
8560 ;EXECUTE INDIVIDUAL PARTS
8570 ;
8580 EXEPRT INC SEQ ;SEQ=SEQ+1
8590 LDA SEQ ;A=SEQ
8600 CMP #1
8610 IF33 BNE THEN33
8620 JSR PART1
8630 JMP THEN45
8640 THEN33 CMP #2
8650 IF34 BNE THEN34
8660 JSR PART2
8670 JMP THEN45
8680 THEN34 CMP #3
8690 IF35 BNE THEN35
8700 JSR PART3
8710 JMP THEN45
8720 THEN35 CMP #4
8730 IF36 BNE THEN36
8740 JSR PART4
8750 JMP THEN45
8760 THEN36 CMP #5
8770 IF37 BNE THEN37
8780 JSR PART5
8790 JMP THEN45
8800 THEN37 CMP #6
8810 IF38 BNE THEN38
8820 JSR PART6
8830 JMP THEN45
8840 THEN38 CMP #7
8850 IF39 BNE THEN39
8860 JSR PART7
8870 JMP THEN45
8880 THEN39 CMP #8
8890 IF40 BNE THEN40
8900 JSR PART8
8910 JMP THEN45
8920 THEN40 CMP #9
8930 IF45 BNE THEN45
8940 JSR PART9
8950 THEN45 RTS
8960 ;
8970 ;PLAY PART9 OF DEMO
8980 ;
8990 PART9 JSR CLRTS ;CLEAR TEXT SCREEN
9000 JSR INCSTR ;START SCROLL
9010 LDA #0
9020 STA ETIMER
9030 LDA #3
9040 STA ETIMER+1
9050 LDA #1
9060 STA ETIMER+2
9070 DEC SEQ ;RESET SEQ TO KEEP LOOPING HERE
9080 INC LINCNT ;LINCNT=LINCNT+1
9090 RTS
9100 ;
9110 ;PLAY PART1 OF DEMO
9120 ;
9130 PART1 JSR INCSTR ;SCROLL WELCOME
9140 LDA #0
9150 STA ETIMER
9160 LDA #5
9170 STA ETIMER+1
9180 LDA #1
9190 STA ETIMER+2
9200 JSR INCSPB
9210 RTS
9220 ;
9230 ;PLAY PART 2 OF DEMO
9240 ;
9250 PART2 JSR CLRTS ;CLEAR TEXT SCREEN
9260 JSR INCSTR ;SCROLL TO
9270 JSR BASOUT
9280 LDA #0
9290 STA ETIMER
9300 LDA #2
9310 STA ETIMER+1
9320 LDA #1
9330 STA ETIMER+2
9340 LDA #$01
9350 STA TEMPMB ;TEMP MAXREC
9360 REPEAT12 LDA #$00
9370 STA DOWHILE1+1
9380 LDA #$A0
9390 STA DOWHILE1+2
9400 LDA TEMPMB
9410 STA MAXBLK
9420 JSR PLAY
9430 JSR BASOUT
9440 INC TEMPMB
9450 LDA TEMPMB
9460 CMP #$09
9470 BNE REPEAT12
9480 JSR INCSPB
9490 RTS
9500 ;
9510 ;PLAY PART 3 OF DEMO
9520 ;
9530 PART3 JSR CLRTS ;CLEAR TEXT SCREEN
9540 JSR INCSTR ;DIGISOUND
9550 JSR BASOUT
9560 LDA #0
9570 STA ETIMER
9580 LDA #2
9590 STA ETIMER+1
9600 LDA #1
9610 STA ETIMER+2
9620 LDA #$0F
9630 STA TEMPMB
9640 REPEAT16 LDA #$00
9650 STA DOWHILE1+1
9660 LDA #$A8
9670 STA DOWHILE1+2
9680 LDA #$03
9690 STA MAXBLK
9700 LDA TEMPMB
9710 STA AMP+1
9720 JSR PLAY
9730 JSR BASOUT
9740 DEC TEMPMB
9750 UNTIL16 BNE REPEAT16
9760 JSR INCSPB
9770 RTS
9780 ;
9790 ;PLAY PART 4 OF DEMO
9800 ;
9810 PART4 JSR CLRTS ;CLEAR TEXT SCREEN
9820 JSR INCSTR ;SCROLL COPYRIGHT
9830 JSR BASOUT
9840 LDA #0
9850 STA ETIMER
9860 LDA #3
9870 STA ETIMER+1
9880 LDA #1
9890 STA ETIMER+2
9900 LDA #$00
9910 STA DOWHILE1+1
9920 LDA #$AB
9930 STA DOWHILE1+2
9940 LDA #$0A
9950 STA MAXBLK
9960 LDA #$0F
9970 STA AMP+1
9980 JSR PLAY
9990 JSR BASOUT
10000 LDA #$0F
10010 STA TEMPMB
10020 REPEAT17 LDA #$00
10030 STA DOWHILE1+1
10040 LDA #$B3
10050 STA DOWHILE1+2
10060 LDA #$02
10070 STA MAXBLK
10080 LDA TEMPMB
10090 STA AMP+1
10100 JSR PLAY
10110 JSR BASOUT
10120 DEC TEMPMB
10130 BNE REPEAT17
10140 JSR INCSPB
10150 RTS
10160 ;
10170 ;PLAY PART 5 OF DEMO
10180 ;
10190 PART5 JSR CLRTS ;CLEAR TEXT SCREEN
10200 JSR INCSTR ;SCROLL SLAMMING SAMMY
10210 JSR BASOUT
10220 LDA #0
10230 STA ETIMER
10240 LDA #4
10250 STA ETIMER+1
10260 LDA #1
10270 STA ETIMER+2
10280 LDA #$01
10290 STA TEMPMB
10300 REPEAT15 LDA #$00
10310 STA DOWHILE1+1
10320 LDA #$B5
10330 STA DOWHILE1+2
10340 LDA TEMPMB
10350 STA MAXBLK
10360 CLC
10370 ADC #$04
10380 STA AMP+1
10390 JSR PLAY
10400 JSR BASOUT
10410 INC TEMPMB
10420 LDA TEMPMB
10430 CMP #$0B
10440 BNE REPEAT15
10450 JSR INCSPB
10460 RTS
10470 ;
10480 ;PLAY PART 6 OF DEMO
10490 ;
10500 PART6 JSR CLRTS ;CLEAR TEXT SCREEN
10510 JSR INCSTR ;SCROLL YNGWIE
10520 LDA #0
10530 STA ETIMER
10540 LDA #4
10550 STA ETIMER+1
10560 LDA #1
10570 STA ETIMER+2
10580 LDA #$00
10590 STA DOWHILE1+1
10600 LDA #$04
10610 STA DOWHILE1+2
10620 LDA #$32
10630 STA MAXBLK
10640 LDA #$0F
10650 STA AMP+1
10660 JSR PLAY
10670 JSR INCSPB
10680 RTS
10690 ;
10700 ;PLAY PART 7 OF DEMO
10710 ;
10720 PART7 JSR CLRTS ;CLEAR TEXT SCREEN
10730 JSR INCSTR ;SCROLL GOOD BYE
10740 LDA #0
10750 STA ETIMER
10760 LDA #4
10770 STA ETIMER+1
10780 LDA #1
10790 STA ETIMER+2
10800 LDA #$00
10810 STA DOWHILE1+1
10820 LDA #$36
10830 STA DOWHILE1+2
10840 LDA #$21
10850 STA MAXBLK
10860 LDA #$0F
10870 STA AMP+1
10880 JSR PLAY
10890 JSR INCSPB
10900 RTS
10910 ;
10920 ;PLAY PART 8 OF DEMO
10930 ;
10940 PART8 JSR CLRTS ;CLEAR TEXT SCREEN
10950 JSR INCSTR ;SCROLL TEST
10960 JSR KEROUT
10970 LDA #0
10980 STA ETIMER
10990 LDA #4
11000 STA ETIMER+1
11010 LDA #1
11020 STA ETIMER+2
11030 LDA #$00
11040 STA DOWHILE1+1
11050 LDA #$E0
11060 STA DOWHILE1+2
11070 LDA #$20
11080 STA MAXBLK
11090 LDA #$0F
11100 STA AMP+1
11110 JSR PLAY
11120 JSR INCSPB
11130 RTS
11140 ;
11150 ;FLIP OUT BASIC ROM
11160 ;
11170 BASOUT LDA R6510
11180 AND %11111110
11190 STA R6510
11200 RTS
11210 ;
11220 ;FLIP IN BASIC ROM
11230 ;
11240 BASIN LDA R6510
11250 ORA %00000001
11260 STA R6510
11270 RTS
11280 ;
11290 ;FLIP OUT KERNAL ROM
11300 ;
11310 KEROUT LDA R6510
11320 AND %11111101
11330 STA R6510
11340 RTS
11350 ;
11360 ;FLIP IN KERNAL ROM
11370 ;
11380 KERIN LDA R6510
11390 ORA %00000010
11400 STA R6510
11410 RTS
11420 ;
11430 ;CLEAR SID CHIP
11440 ;
11450 CLRSID LDX #$00
11460 TXA
11470 REPEAT13 STA SIDREG,X
11480 INX
11490 CPX #$1C
11500 UNTIL13 BNE REPEAT13
11510 RTS
11520 ;
11530 ;VARIABLES AND DATA
11540 ;
11550 ;
11560 ;FILE VARIABLES
11570 ;
11580 DEVICE :B $08 ;LOAD DEVICE #
11590 FNAME :B "MESSAGE.DAT*????" ;8400-87FF
11600 :B "OLDTIME.FNT*????" ;8800-89FF
11610 :B "DEMO.PAL*???????" ;5C00-5FFF
11620 :B "COMMLOGO.MOB*???" ;5700-5BFF
11630 :B "DEMO.BMP*???????" ;6000-7FFF
11640 :B "WELCOME.SAM*????" ;A000-BFFF
11650 :B "GOODBYE.SAM*????" ;E000-FFFF
11660 :B "SAMMY.SAM*??????" ;0400-56FF
11670 ;
11680 ;SPRITE AND GRAPHICS VARIABLES
11690 ;
11700 SPCOL1 :B #11,#11,#11,#12,#15,#15,#15,#12,#11,#11,#11,#11,#11,#12,#1
5,#15
11710 :B #15,#12,#11,#11
11720 RTIMER :B $00 ;ROTATION TIMER
11730 MTIMER :B $00 ;MOVEMENT TIMER
11740 ROTDIR :B $00,$00,$00,$00,$00,$00,$00,$00 ;ROTATION DIRECTIONS
11750 SCOUNT :B $00 ;SPRITE COUNTER
11760 XDIR :B $00,$00,$00,$
