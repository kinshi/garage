1000 ;================================
1010 ;COMMIE UFO ATTACK V1.0
1020 ;(C) 1986 STEVE GOLDSMITH
1030 ;ALL RIGHTS RESERVED
1040 ;
1050 ;USE COMMODORE'S MACRO ASSEMBLER
1060 ;ASSEMBLE
1070 ;================================
1080 ;
1090 *=$8000
1100 SETLFS = $FFBA ;SET LOGICAL FILE #, DEVICE, COMMAND
1110 SETNAM = $FFBD ;SET FILE NAME
1120 LOAD = $FFD5 ;LOAD RAM FROM DEVICE
1130 PRINT = $FFD2 ;KERNAL CHAR PRINT ROUTINE
1140 PLOT = $FFF0 ;SET CURSOR LOCATION
1150 GETIN = $FFE4 ;GET CHAR FROM KEYBOARD
1160 CCOLOR = $0286 ;CURSOR COLOR
1170 VICII = $D000 ;VIDEO CHIP
1180 CIA1 = $DC00 ;COMPLEX INTERFACE ADAPTER #1
1190 CIA2 = $DD00 ;COMPLEX INTERFACE ADAPTER #2
1200 KSCRN = $288 ;KERNAL START OF SCREEN
1210 IRQVEC = $0314 ;IRQ HARDWARE VECTOR
1220 NRMIRQ =$EA31 ;NORMAL IRQ VECTOR
1230 SCREEN = $C800 ;START OF SCREEN MEMORY
1240 COLMEM = $D800 ;CHARACTER COLOR MEM
1250 SPRPTR = SCREEN+$3F8 ;SPRITE POINTERS
1260 SID = $D400 ;START OF SOUND CHIP
1270 INDEX = $FB ;ZERO PAGE INDEXER
1280 ;
1290 ;INITILIZE PROGRAM
1300 ;
1310 JSR LOADCS ;LOAD CHARS AND SPRITES
1320 JSR SETBNK ;SET GRAPHICS BANK
1330 JSR TITLE ;DISPLAY TITLE SCREEN
1340 JSR SETIRQ ;CRANK UP NEW IRQ
1350 REPLAY JSR INITSP ;INIT PLAYFIELD
1360 ;
1370 ;MAIN LOOP
1380 ;
1390 MAIN DEC MLOOP ;MISSLE MOVES TWICE AS FAST
1400 BNE LOOP89
1410 LDA #$02
1420 STA MLOOP
1430 LDA VICII+$1E ;GET COLLISION REG
1440 STA COLREG ;SAVE COLLISION REG
1450 JSR TANK ;MOVE TANK AND FIRE MISSLE
1460 LDA NUMTNK ;GET NUMBER OF TANKS
1470 BNE LOOP78 ;ANY TANKS LEFT?
1480 JMP ENDGAM ;END GAME
1490 LOOP78 JSR UFO1 ;MOVE UFO1 AND DROP BOMBS
1500 JSR UFO2 ;MOVE UFO2 AND DROP BOMBS
1510 JSR SCROLL ;SCROLL BOTTOM LINE ON SCREEN
1520 LDA VICII+$1E ;GET COLLISION REG
1530 STA COLREG ;SAVE COLLISION REG
1540 LOOP89 JSR MISSLE ;MOVE MISSLE
1550 SEC ;TIME DELAY
1560 LDA #$0A
1570 SBC LEVEL ;HIGHER LEVEL = FASTER DELAY
1580 TAY
1590 LOOP79 LDX #$40 ;SECONDARY DELAY
1600 LOOP80 DEX
1610 BNE LOOP80
1620 DEY
1630 BNE LOOP79
1640 JMP MAIN
1650 ;
1660 ;LOAD CHARACTER AND SPRITE DATA
1670 ;
1680 LOADCS LDA #$01 ;FILE #
1690 LDX #$08 ;DEVICE #
1700 LDY #$01 ;COMMAND
1710 JSR SETLFS ;SET UP FILE
1720 LDA #$0A ;# OF CHARS IN NAME
1730 LDX #<NAME ;GET ADDR OF FILE NAME
1740 LDY #>NAME
1750 JSR SETNAM ;SET UP NAME
1760 LDA #$00 ;SET FOR LOAD
1770 JSR LOAD ;LOAD FILE
1780 RTS
1790 ;
1800 ;SET BANK + GRAPHICS MODE
1810 ;
1820 SETBNK LDA CIA2+2
1830 ORA #$03 ;SET BITS 0 & 1 TO OUTPUTS
1840 STA CIA2+2
1850 LDA CIA2
1860 AND #$FC ;SELECT BANK 3 FOR GRAPHICS
1870 STA CIA2
1880 LDA #$20
1890 STA VICII+$18 ;CHARACTERS @ $C000 AND SCREEN @ $C800
1900 LDA #$C8
1910 STA KSCRN ;TELL KERNAL WHERE SCREEN IS
1920 RTS
1930 ;
1940 ;SET IRQ TO NEW LOCATION
1950 ;
1960 SETIRQ SEI
1970 LDA #<NEWIRQ
1980 STA IRQVEC
1990 LDA #>NEWIRQ
2000 STA IRQVEC+1
2010 CLI
2020 RTS
2030 ;
2040 ;NEW IRQ ROUTINE
2050 ;
2060 NEWIRQ LDX RTSCN
2070 LDA RTNUM,X ;GET ROUTINE #
2080 BEQ LOOP4 ;SKIP TO NEXT READ POSITION
2090 CMP #$01
2100 BNE LOOP1
2110 JSR RT1
2120 JMP LOOP4
2130 LOOP1 CMP #$02
2140 BNE LOOP2
2150 JSR RT2
2160 JMP LOOP4
2170 LOOP2 CMP #$03
2180 BNE LOOP3
2190 JSR RT3
2200 JMP LOOP4
2210 LOOP3 JSR RT4
2220 LOOP4 LDX RTSCN
2230 INX
2240 CPX #$04 ;SCAN FOR 4 ROUTINES
2250 BNE LOOP5
2260 LDX #$00
2270 LOOP5 STX RTSCN
2280 JMP NRMIRQ
2290 RT4 RTS ;ROUTINE 4 NOT USED
2300 ;
2310 ;INITILIZE SPRITES, PLAY FIELD, SCORE, # OF TANKS, AND LEVEL
2320 ;
2330 INITSP LDX #$00 ;CLEAR SID CHIP
2340 TXA
2350 LOOP76 STA SID,X
2360 INX
2370 CPX #$18
2380 BNE LOOP76
2390 LDA #$00 ;ZERO SCORE
2400 STA SC
2410 STA SC+1
2420 STA SC+2
2430 LDA #$02
2440 STA MLOOP ;# OF TIMES MISSLE MOVES VS TANK AND UFOS
2450 LDA #$03
2460 STA NUMTNK ; # OF TANKS
2470 LDA #$01
2480 STA LEVEL ;SET LEVEL TO 1
2490 LDX #$00 ;SET SPRITE 0-6 POINTER AND COLOR
2500 LOOP8 LDA SPRTBL,X
2510 STA SPRPTR,X ;SET SPRITE POINTER
2520 LDA SPCOLR,X
2530 STA VICII+$27,X ;SET SPRITE COLOR
2540 INX
2550 CPX #$08
2560 BNE LOOP8
2570 LDX #$AB ;PUT TANK ON SCREEN
2580 LDY #$DD
2590 STX VICII ;SET X POS
2600 STY VICII+1 ;SET Y POS
2610 LDA #%00000001
2620 STA VICII+$15 ;TURN TANK ON
2630 LDX #$00
2640 LOOP6 LDA SDATA,X ;CLEAR SCREEN AND PRINT TOP LINE
2650 JSR PRINT ;PRINT CHARS
2660 INX
2670 CPX #$22
2680 BNE LOOP6
2690 LDX #$00 ;SET COLOR FOR BOTTOM LINE ON SCREEN
2700 LDA #$03 ;CYAN
2710 LOOP77 STA COLMEM+$03C0,X
2720 INX
2730 CPX #$28
2740 BNE LOOP77
2750 LDA #$47 ;SET UP BOTTOM LINE FOR SCROLL
2760 STA SCREEN+$03E7
2770 LDA VICII+$1E ;CLEAR COLLISION REG
2780 LDA #$0F
2790 STA SID+$18 ;TURN VOLUME ON
2800 RTS
2810 ;
2820 ;READ COLLISION REG, JOYSTICK, AND MOVE TANK OR FIRE MISSLE
2830 ;
2840 TANK LDA TNKEXP ;SEE IF TANK EXPLODING
2850 BEQ LOOP67
2860 RTS
2870 LOOP67 LDA COLREG ;SEE IF TANK HIT
2880 AND #%00000001 ;SEE IF TANK HIT
2890 BEQ LOOP66
2900 DEC NUMTNK ;DECREASE # OF TANKS
2910 LDA #$0F
2920 STA TIMER3 9/15 TH SECOND
2930 LDA #$09
2940 STA SID+$05 ;SET ATTACK/DECAY
2950 LDA #$70
2960 STA SID+$06 ;SET SUSTAIN/RELEASE
2970 LDA #$80
2980 STA SID ;LO FREQ
2990 LDA #$01
3000 STA SID+1 ;HI FREQ
3010 STA TNKSND
3020 LDA #%10000001
3030 STA SID+$04 ;SET RANDOM NOISE + GATE BIT
3040 LDA #$03
3050 STA TNKEXP ;SKIP JOYSTICK INPUT
3060 STA RTNUM+2 ;START IRQ PROCESSING
3070 LDA #$01
3080 STA VICII+$17 ;EXPAND Y
3090 LDA #$D5
3100 STA VICII+1 ;EXPLOSION Y
3110 RTS
3120 LOOP66 LDA CIA1
3130 AND #%00011111 ;GET DIRECTIONS
3140 CMP #%00001111 ;CHECK FOR FIRE
3150 BEQ FIRE ;FIRE MISSLE
3160 CMP #%00011011 ;CHECK FOR LEFT
3170 BEQ LEFT
3180 CMP #%00010111 ;CHECK FOR RIGHT
3190 BEQ RIGHT
3200 CMP #%00001011 ;CHECK FOR LEFT + FIRE
3210 BNE LOOP20
3220 JSR FIRE
3230 JMP LEFT
3240 LOOP20 CMP #%00000111 ;CHECK FOR RIGHT + FIRE
3250 BNE LOOP56
3260 JSR FIRE
3270 JMP RIGHT
3280 LOOP56 RTS
3290 LEFT LDA VICII+$10 ;MOVE TANK LEFT
3300 AND #%00000001 ;SEE IF MSB OF X IS SET
3310 BEQ LOOP9
3320 LDA VICII ;SEE IF TANK IS @ $100
3330 BNE LOOP11
3340 LDA VICII+$10
3350 AND #%11111110 ;TANK REACHED $FF
3360 STA VICII+$10
3370 LOOP9 LDA VICII
3380 CMP #$18 ;LEFT EDGE OF SCREEN
3390 BEQ LOOP10
3400 LOOP11 DEC VICII ;MOVE TANK 1 LEFT
3410 LOOP10 RTS
3420 RIGHT LDA VICII+$10 ;MOVE TANK RIGHT
3430 AND #%00000001 ;SEE IF MSB OF X IS SET
3440 BNE LOOP12
3450 LDA VICII ;SEE IF TANK IS @ $FF
3460 CMP #$FF
3470 BNE LOOP13
3480 LDA VICII+$10
3490 ORA #%00000001 ;TANK REACHED $100
3500 STA VICII+$10
3510 LOOP12 LDA VICII
3520 CMP #$40 ;RIGHT EDGE OF SCREEN
3530 BEQ LOOP14
3540 LOOP13 INC VICII ;MOVE TANK 1 RIGHT
3550 LOOP14 RTS
3560 FIRE LDA FIRTGL ;SEE IF MISSLE ALL READY SHOT
3570 BEQ LOOP15 ;SHOOT MISSLE
3580 RTS
3590 LOOP15 LDA #$01
3600 STA FIRTGL
3610 LDA VICII+$10
3620 AND #%00000001 ;SEE IF MSB OF TANK X POS SET
3630 BNE LOOP18 ;MSB OF TANK X SET
3640 LDA VICII+$10
3650 AND #%11111101 ;MSB OF TANK X NOT SET
3660 JMP LOOP19
3670 LOOP18 LDA VICII+$10
3680 ORA #%00000010
3690 LOOP19 STA VICII+$10
3700 LDA VICII ;GET TANKS X POS
3710 STA VICII+2 ;MISSLE X
3720 LDA #$D9
3730 STA VICII+3 ;MISSLE Y
3740 LDA VICII+$15
3750 ORA #%00000010 ;TURN MISSLE ON
3760 STA VICII+$15
3770 LDA #$11 ;SET ATTACK/DECAY V1
3780 STA SID+$05
3790 LDA #$F6 ;SET SUSTAIN/RELEASE V1
3800 STA SID+$06
3810 LDA #$80 ;STORE MISSLE FREQ.
3820 STA SID
3830 LDA #$03
3840 STA SID+1
3850 LDA #%10000001 ;SET RANDOM NOISE + GATE BIT
3860 STA SID+$04
3870 LDA #%10000000
3880 STA SID+$04 ;START RELEASE CYCLE
3890 RTS
3900 ;
3910 ;MISSLE MOVEMENT
3920 ;
3930 MISSLE LDA FIRTGL ;SEE IF MISSLE IS IN FLIGHT
3940 BNE LOOP16
3950 RTS
3960 LOOP16 LDA VICII+3 ;GET MISSLE Y POS
3970 CMP #$32 ;SEE IF @ TOP OF SCREEN
3980 BEQ LOOP17
3990 DEC VICII+3 ;MOVE MISSLE UP 1
4000 RTS
4010 LOOP17 LDA VICII+$15
4020 AND #%11111101 ;TURN MISSLE OFF
4030 STA VICII+$15
4040 LDA #$00 ;CAN NOW FIRE ANOTHER MISSLE
4050 STA FIRTGL
4060 STA COLREG ;CLEAR C-REG SAVE
4070 LDA VICII+$1E ;CLEAR SS C-REG
4080 RTS
4090 ;
4100 ;INIT UFOS
4110 ;
4120 INUFOS LDA VICII+$12
4130 AND #%01111111
4140 CLC
4150 ADC #$38
4160 STA YPOS ;SAVE Y POS
4170 LDA VICII+$12
4180 BMI LOOP21
4190 LDA #$01 ;RIGHT TO LEFT
4200 STA UFODIR
4210 LDA #$57
4220 STA XPOS
4230 RTS
4240 LOOP21 LDA #$00 ;LEFT TO RIGHT
4250 STA UFODIR
4260 LDA #$01
4270 STA XPOS
4280 RTS
4290 ;
4300 ;MOVE UFO 1
4310 ;
4320 UFO1 LDA INITU1 ;SEE IF INIT YET
4330 BNE LOOP22
4340 LDA #$01
4350 STA INITU1
4360 JSR INUFOS ;GET X,Y, AND DIRECTION
4370 LDA VICII+$10 ;GET MSB OF UFO
4380 LDX UFODIR
4390 STX U1DIR ;SAVE DIRECTION
4400 BNE LOOP23 ;SET MSB OF UFO
4410 AND #%11111011 ;LEFT TO RIGHT
4420 JMP LOOP24
4430 LOOP23 ORA #%00000100 ;RIGHT TO LEFT
4440 LOOP24 STA VICII+$10
4450 LDA XPOS ;SET X AND Y POS
4460 STA VICII+4
4470 LDA YPOS
4480 STA VICII+5
4490 LDA VICII+$15
4500 ORA #%00000100 ;TURN UFO ON
4510 STA VICII+$15
4520 LOOP22 LDA BD1 ;SEE IF BOMB HAS BEEN DROPED
4530 BNE LOOP45
4540 LDA VICII+$12 ;DROP BOMB?
4550 CMP #$01
4560 BNE LOOP46
4570 LDA #$01
4580 STA BD1
4590 LOOP45 JSR BOMB1
4600 LOOP46 LDA COLREG ;GET COLLISION REG
4610 AND #%00000110
4620 CMP #%00000110 ;SEE IF MISSLE HIT UFO
4630 BNE LOOP60 ;NO
4640 JSR LOOP17 ;KILL MISSLE
4650 JSR LOOP28 ;KILL UFO
4660 LDX #$00
4670 LDY LEVEL ;SCORE = LEVEL*100
4680 JSR SCORE ;SCORE POINTS
4690 LDX VICII+4 ;UFO X LSB
4700 LDY VICII+5 ;UFO Y
4710 LDA VICII+$10 ;UFO X MSB
4720 AND #%00000100
4730 CLC
4740 BEQ LOOP61
4750 SEC
4760 LOOP61 JMP EXP2 ;INIT EXPLOSION
4770 LOOP60 LDA U1DIR ;GET UFO DIRECTION
4780 BEQ LOOP25
4790 LDA VICII+$10 ;MOVE RIGHT TO LEFT
4800 AND #%00000100 ;SEE IF MSB OF X SET
4810 BEQ LOOP26
4820 LDA VICII+4 ;SEE IF UFO IS @ $100
4830 BNE LOOP27
4840 LDA VICII+$10
4850 AND #%11111011 ;UFO REACHED $FF
4860 STA VICII+$10
4870 LOOP26 LDA VICII+4
4880 CMP #$01 ;LEFT EDGE OF SCREEN
4890 BEQ LOOP28
4900 LOOP27 DEC VICII+4
4910 RTS
4920 LOOP25 LDA VICII+$10 ;MOVE LEFT TO RIGHT
4930 AND #%00000100 ;SEE IF MSB OF X IS SET
4940 BNE LOOP29
4950 LDA VICII+4 ;SEE IF UFO IS @ $FF
4960 CMP #$FF
4970 BNE LOOP30
4980 LDA VICII+$10
4990 ORA #%00000100 ;UFO REACHED $100
5000 STA VICII+$10
5010 LOOP29 LDA VICII+4
5020 CMP #$57 ;RIGHT EDGE OF SCREEN
5030 BEQ LOOP28
5040 LOOP30 INC VICII+4
5050 RTS
5060 LOOP28 LDA VICII+$15
5070 AND #%11111011 ;TURN UFO OFF
5080 STA VICII+$15
5090 LDA #$00
5100 STA INITU1
5110 RTS
5120 ;
5130 ;MOVE UFO 2
5140 ;
5150 UFO2 LDA INITU2 ;SEE IF INIT YET
5160 BNE LOOP31
5170 LDA #$01
5180 STA INITU2
5190 JSR INUFOS ;GET X,Y, AND DIRECTION
5200 LDA VICII+$10 ;GET MSB OF UFO
5210 LDX UFODIR
5220 STX U2DIR ;SAVE DIRECTION
5230 BNE LOOP32 ;SET MSB OF UFO
5240 AND #%11110111 ;LEFT TO RIGHT
5250 JMP LOOP33
5260 LOOP32 ORA #%00001000 ;RIGHT TO LEFT
5270 LOOP33 STA VICII+$10
5280 LDA XPOS ;SET X AND Y POS
5290 STA VICII+6
5300 LDA YPOS
5310 STA VICII+7
5320 LDA VICII+$15
5330 ORA #%00001000 ;TURN UFO ON
5340 STA VICII+$15
5350 LOOP31 LDA VICII+7
5360 CMP #$D0
5370 BEQ LOOP40
5380 LDA VICII+$12
5390 AND #$0F
5400 BNE LOOP40
5410 INC VICII+7
5420 LOOP40 LDA BD2 ;SEE IF BOMB HAS BEEN DROPED
5430 BNE LOOP47
5440 LDA VICII+$12 ;DROP BOMB?
5450 CMP #$01
5460 BNE LOOP48
5470 LDA #$01
5480 STA BD2
5490 LOOP47 JSR BOMB2
5500 LOOP48 LDA COLREG ;GET COLLISION REG
5510 AND #%00001010
5520 CMP #%00001010 ;SEE IF MISSLE HIT UFO
5530 BNE LOOP64 ;NO
5540 JSR LOOP17 ;KILL MISSLE
5550 JSR LOOP37 ;KILL UFO
5560 LDX #$00
5570 LDY LEVEL ;SCORE = LEVEL*100
5580 JSR SCORE ;SCORE POINTS
5590 LDX VICII+6 ;UFO X LSB
5600 LDY VICII+7 ;UFO Y
5610 LDA VICII+$10 ;UFO X MSB
5620 AND #%00001000
5630 CLC
5640 BEQ LOOP65
5650 SEC
5660 LOOP65 JMP EXP2 ;INIT EXPLOSION
5670 LOOP64 LDA U2DIR
5680 BEQ LOOP34
5690 LDA VICII+$10 ;MOVE RIGHT TO LEFT
5700 AND #%00001000 ;SEE IF MSB OF X SET
5710 BEQ LOOP35
5720 LDA VICII+6 ;SEE IF UFO IS @ $100
5730 BNE LOOP36
5740 LDA VICII+$10
5750 AND #%11110111 ;UFO REACHED $FF
5760 STA VICII+$10
5770 LOOP35 LDA VICII+6
5780 CMP #$01 ;LEFT EDGE OF SCREEN
5790 BEQ LOOP37
5800 LOOP36 DEC VICII+6
5810 RTS
5820 LOOP34 LDA VICII+$10 ;MOVE LEFT TO RIGHT
5830 AND #%00001000 ;SEE IF MSB OF X IS SET
5840 BNE LOOP38
5850 LDA VICII+6 ;SEE IF UFO IS @ $FF
5860 CMP #$FF
5870 BNE LOOP39
5880 LDA VICII+$10
5890 ORA #%00001000 ;UFO REACHED $100
5900 STA VICII+$10
5910 LOOP38 LDA VICII+6
5920 CMP #$57 ;RIGHT EDGE OF SCREEN
5930 BEQ LOOP37
5940 LOOP39 INC VICII+6
5950 RTS
5960 LOOP37 LDA VICII+$15
5970 AND #%11110111 ;TURN UFO OFF
5980 STA VICII+$15
5990 LDA #$00
6000 STA INITU2
6010 RTS
6020 ;
6030 ;BOMB 1 MOVEMENT
6040 ;
6050 BOMB1 LDA INITB1 ;SEE IF BOMB INIT YET
6060 BNE LOOP41
6070 LDA #$01
6080 STA INITB1
6090 LDA VICII+4 ;GET UFO 1 X POS
6100 STA VICII+8
6110 LDA VICII+$10
6120 AND #%00000100 ;SEE IF MSB OF UFO IS SET
6130 BNE LOOP42
6140 LDA VICII+$10
6150 AND #%11101111
6160 JMP LOOP43
6170 LOOP42 LDA VICII+$10
6180 ORA #%00010000
6190 LOOP43 STA VICII+$10
6200 LDA VICII+5 ;GET UFO 1 Y POS
6210 STA VICII+9
6220 LDA VICII+$15
6230 ORA #%00010000 ;TURN BOMB ON
6240 STA VICII+$15
6250 LDA #$D0
6260 STA SID+$0C ;SET ATTACK/DECAY V2
6270 LDA #$00
6280 STA SID+$0D ;SET SUSTAIN/RELEASE V2
6290 LDA #$00
6300 STA SID+$07 ;SET FREQ LO
6310 LDA #$E0
6320 STA SID+$08 ;SET FREQ HI
6330 STA B1FREQ ;SAVE HI FREQ
6340 LDA #%00100001 ;SELECT SAWTOOTH WAVEFORM AND GATE BIT
6350 STA SID+$0B
6360 LOOP41 LDA VICII+9
6370 CMP #$DD
6380 BNE LOOP74
6390 LDX #%00100000
6400 STX SID+$0B ;START RELEASE CYCLE
6410 LOOP74 CMP #$E5 ;SEE IF BOMB IS @ BOTTOM OF SCREEN
6420 BEQ LOOP44
6430 INC VICII+9 ;MOVE BOMB 1 DOWN
6440 LDA COLREG ;GET COLLISION REG
6450 AND #%00010010 ;SEE IF BOMB AND MISSLE HIT
6460 CMP #%00010010
6470 BNE LOOP58 ;NO
6480 LDA #%00100000
6490 STA SID+$0B ;START RELEASE CYCLE
6500 LDX #$00
6510 LDY #$01
6520 JSR SCORE ;ADD 100 TO SCORE
6530 JSR LOOP17 ;KILL MISSLE
6540 JMP LOOP44 ;KILL BOMB
6550 LOOP58 DEC B1FREQ
6560 LDA B1FREQ
6570 STA SID+$08 ;LOWER FREQ
6580 RTS
6590 LOOP44 LDA #$00
6600 STA INITB1
6610 STA BD1
6620 LDA VICII+$15
6630 AND #%11101111 ;TURN OFF
6640 STA VICII+$15
6650 LDX VICII+8 ;BOMB X LO
6660 LDY VICII+9 ;BOMB Y
6670 CLC
6680 LDA VICII+$10 ;GET X HI
6690 AND #%00010000
6700 BEQ LOOP53
6710 SEC
6720 LOOP53 JMP EXP1 ;INIT EXPLOSION
6730 ;
6740 ;BOMB 2 MOVEMENT
6750 ;
6760 BOMB2 LDA INITB2 ;SEE IF BOMB INIT YET
6770 BNE LOOP49
6780 LDA #$01
6790 STA INITB2
6800 LDA VICII+6 ;GET UFO 2 X POS
6810 STA VICII+10
6820 LDA VICII+$10
6830 AND #%00001000 ;SEE IF MSB OF UFO IS SET
6840 BNE LOOP50
6850 LDA VICII+$10
6860 AND #%11011111
6870 JMP LOOP51
6880 LOOP50 LDA VICII+$10
6890 ORA #%00100000
6900 LOOP51 STA VICII+$10
6910 LDA VICII+7 ;GET UFO 2 Y POS
6920 STA VICII+11
6930 LDA VICII+$15
6940 ORA #%00100000 ;TURN BOMB ON
6950 STA VICII+$15
6960 LDA #$D0
6970 STA SID+$13 ;SET ATTACK/DECAY V3
6980 LDA #$00
6990 STA SID+$14 ;SET SUSTAIN/RELEASE V3
7000 LDA #$00
7010 STA SID+$0E ;SET FREQ LO
7020 LDA #$E0
7030 STA SID+$0F ;SET FREQ HI
7040 STA B2FREQ ;SAVE HI FREQ
7050 LDA #%00100001 ;SELECT SAWTOOTH WAVEFORM AND GATE BIT
7060 STA SID+$12
7070 LOOP49 LDA VICII+11
7080 CMP #$DD
7090 BNE LOOP75
7100 LDX #%00100000 ;START RELEASE CYCLE
7110 STX SID+$12
7120 LOOP75 CMP #$E5 ;SEE IF BOMB IS @ BOTTOM OF SCREEN
7130 BEQ LOOP52
7140 INC VICII+11 ;MOVE BOMB 2 DOWN
7150 LDA COLREG ;GET COLLISION REG
7160 AND #%00100010 ;SEE IF BOMB AND MISSLE HIT
7170 CMP #%00100010
7180 BNE LOOP59 ;NO
7190 LDA #%00100000
7200 STA SID+$12 ;START RELEASE CYCLE
7210 LDX #$00
7220 LDY #$01
7230 JSR SCORE ;ADD 100 TO SCORE
7240 JSR LOOP17 ;KILL MISSLE
7250 JMP LOOP52 ;KILL BOMB
7260 LOOP59 DEC B2FREQ ;LOWER FREQ
7270 LDA B2FREQ
7280 STA SID+$0F
7290 RTS
7300 LOOP52 LDA #$00
7310 STA INITB2
7320 STA BD2
7330 LDA VICII+$15
7340 AND #%11011111
7350 STA VICII+$15
7360 LDX VICII+10 ;BOMB X LO
7370 LDY VICII+11 ;BOMB Y
7380 CLC
7390 LDA VICII+$10 ;GET X HI
7400 AND #%00100000
7410 BEQ LOOP57
7420 SEC
7430 LOOP57 JMP EXP1 ;INIT EXPLOSION
7440 ;
7450 ;BOMB EXPLOSION
7460 ;
7470 EXP1 STX VICII+12 ;EXP X LO
7480 STY VICII+13 ;EXP Y
7490 LDA VICII+$10 ;GET X HI
7500 AND #%10111111
7510 BCC LOOP54 ;X HI NOT SET
7520 ORA #%01000000
7530 LOOP54 STA VICII+$10
7540 LDA VICII+$15
7550 ORA #%01000000 ;TURN ON
7560 STA VICII+$15
7570 LDA #$08 ;8/15 TH OF A SEC
7580 STA TIMER1
7590 LDA #$01
7600 STA RTNUM+3 ;START IRQ PROCESSING
7610 RTS
7620 ;
7630 ;BOMB EXPLOSION IRQ PROCESSING
7640 ;
7650 RT1 LDX TIMER1
7660 LDA TIMER1,X
7670 STA VICII+$2D ;CHANGE COLOR
7680 DEC TIMER1
7690 BNE LOOP55
7700 LDA VICII+$15
7710 AND #%10111111 ;TURN OFF
7720 STA VICII+$15
7730 LDA #$00
7740 STA RTNUM+3 ;STOP IRQ PROCESSING
7750 LOOP55 RTS
7760 ;
7770 ;UFO EXPLOSION INITILIZE
7780 ;
7790 EXP2 STX VICII+14 ;EXP X LO
7800 STY VICII+15 ;EXP Y
7810 LDA VICII+$10 ;GET X HI
7820 AND #%01111111
7830 BCC LOOP62 ;X HI NOT SET
7840 ORA #%10000000
7850 LOOP62 STA VICII+$10
7860 LDA #$80 ;SET ATTACK/DECAY V1
7870 STA SID+$05
7880 LDA #$F8 ;SET SUSTAIN/RELEASE V1
7890 STA SID+$06
7900 LDA #$FF ;STORE MISSLE FREQ.
7910 STA SID ;LO FREQ
7920 LDA #$81
7930 STA SID+1 ;HI FREQ
7940 STA EXPFRQ
7950 LDA #%10000001 ;SET RANDOM NOISE + GATE BIT
7960 STA SID+$04
7970 LDA #%10000000
7980 STA SID+$04 ;START RELEASE CYCLE
7990 LDA #$06 ; 6/15 TH SECOND
8000 STA TIMER2
8010 LDA #$02
8020 STA RTNUM+1 ;START IRQ PROCESSING
8030 LDA VICII+$15
8040 ORA #%10000000 ;TURN ON
8050 STA VICII+$15
8060 RTS
8070 ;
8080 ;UFO EXPLOSION IRQ PROCESSING
8090 ;
8100 RT2 LDX TIMER2
8110 LDA TIMER2,X
8120 STA SPRPTR+7 ;CHANGE SPRITE POINTER
8130 ROL EXPFRQ
8140 LDA EXPFRQ
8150 STA SID+1 ;CHANGE SOUND
8160 DEC TIMER2
8170 BNE LOOP63
8180 LDA VICII+$15
8190 AND #%01111111 ;TURN OFF
8200 STA VICII+$15
8210 LDA #$00
8220 STA RTNUM+1 ;STOP IRQ PROCESSING
8230 LOOP63 RTS
8240 ;
8250 ;TANK EXPLOSION IRQ PROCESSING
8260 ;
8270 RT3 LDX TIMER3
8280 LDA EXPCLR,X
8290 STA VICII+$27 ;CHANGE COLOR
8300 LDA TIMER3,X
8310 STA SPRPTR ;CHANGE SPRITE POINTER
8320 ROR TNKSND
8330 LDA TNKSND
8340 STA SID+$01 ;CHANGE SOUND
8350 DEC TIMER3
8360 BNE LOOP68
8370 LDA #$00
8380 STA VICII+$17 ;UNEXPAND Y
8390 LDA #$05
8400 STA VICII+$27 ;RESTORE COLOR
8410 LDA #$AB
8420 STA VICII ;SET TANK X LO
8430 LDA #$DD
8440 STA VICII+1 ;TANK Y
8450 LDA VICII+$10
8460 AND #%11111110
8470 STA VICII+$10 ;SET MSB X
8480 LDA #$10
8490 STA SPRPTR ;RESTORE TANK
8500 LDA #$00
8510 STA SID+$04
8520 STA RTNUM+2 ;STOP IRQ PROCESSING
8530 STA TNKEXP ;RESTART JOYSTICK READ
8540 LDA VICII+$1E ;CLEAR COLLISION REG
8550 LDX NUMTNK ;GET # LEFT
8560 LDA #$20 ;SPACE
8570 STA SCREEN+$1B,X ;ERASE 1 TANK
8580 LOOP68 RTS
8590 ;
8600 ;SCROLL BOTTOM LINE OF SCREEN
8610 ;
8620 SCROLL LDA SCREEN+$03E7
8630 PHA ;SAVE RIGHT MOST CHAR
8640 LDX #$00
8650 LOOP69 LDA SCREEN+$3C1,X ;GET CHAR 1 SPACE TO THE RIGHT
8660 STA SCREEN+$03C0,X ;STORE 1 TO THE LEFT
8670 INX
8680 CPX #$27 ;MOVE 39 CHARS
8690 BNE LOOP69
8700 PLA ;GET MOST RIGHT CHAR
8710 LDX VICII+$12 ;GET RANDOM #
8720 BMI LOOP70
8730 CMP #$47 ;MAX LINE LEVEL
8740 BEQ LOOP71
8750 INC SCREEN+$03E7 ;LOWER LINE
8760 RTS
8770 LOOP70 CMP #$40 ;MIN LINE LEVEL
8780 BEQ LOOP71
8790 DEC SCREEN+$03E7 ;RAISE LINE
8800 RTS
8810 LOOP71 STA SCREEN+$03E7
8820 RTS
8830 ;
8840 ;UPDATE AND DISPLAY SCORE
8850 ;SET X FOR LOW 2 DIGITS AND Y FOR MIDDLE 2 DIGITS
8860 ;
8870 SCORE SED ;ADDITION IN DECIMAL
8880 CLC
8890 TXA
8900 ADC SC ;ADD DIGITS 0&1
8910 STA SC
8920 LDA #$00
8930 ADC SC+1 ;ADD CARRY
8940 STA SC+1
8950 TYA
8960 ADC SC+1 ;ADD DIGITS 2&3
8970 STA SC+1
8980 LDA #$00
8990 ADC SC+2 ;ADD CARRY
9000 STA SC+2
9010 CLD ;BACK TO BINARY
9020 LDX #$00
9030 LDY #$06
9040 LOOP72 LDA SC,X
9050 PHA ;SAVE DIGITS
9060 AND #$0F ;GET RIGHT DIGIT
9070 CLC
9080 ADC #$30 ;ADD SCREEN CODE FOR '0'
9090 STA SCREEN+$05,Y
9100 DEY
9110 PLA
9120 LSR A ;
9130 LSR A ; GET LEFT DIGIT
9140 LSR A ;
9150 LSR A ;
9160 CLC
9170 ADC #$30 ;ADD '0' SCREEN CODE
9180 STA SCREEN+$05,Y
9190 DEY
9200 INX
9210 CPX #$03 ;3 DIGIT PAIRS
9220 BNE LOOP72
9230 LDA SC+2
9240 CMP LEVEL
9250 BNE LOOP73
9260 INC LEVEL ;INCREASE LEVEL
9270 INC SCREEN+$13 ;DISPLAY NEW LEVEL
9280 INC NUMTNK ;BONUS TANK
9290 LDX NUMTNK
9300 LDA #$48 ;TANK CHAR
9310 STA SCREEN+$1A,X ;DISPLAY TANKS
9320 LDA #$05 ;GREEN
9330 STA COLMEM+$1A,X ;SET COLOR
9340 LOOP73 RTS
9350 ;
9360 ;END GAME
9370 ;
9380 ENDGAM LDA #%01000001
9390 STA VICII+$15 ;TURN ALL SPRITES OFF, BUT EXPLOSIONS
9400 JSR LOOP17 ;KILL MISSLE
9410 JSR LOOP28 ;KILL UFO1
9420 JSR LOOP37 ;KILL UFO2
9430 JSR LOOP44 ;KILL BOMB1
9440 JSR LOOP52 ;KILL BOMB2
9450 LDA #$17
9460 STA SPRPTR+1 ;SET SPRITE POINTER FOR GAME OVER SPRITE
9470 LDA VICII+$10 ;GET X MSB
9480 AND #%11111101 ;CLEAR
9490 STA VICII+$10
9500 LDA #$A1
9510 STA VICII+2 ;SET X
9520 LDA #$22
9530 STA VICII+3 ;SET Y
9540 LDA #%00000010
9550 STA VICII+$1D ;EXPAND X
9560 LDA #%00000010
9570 ORA VICII+$15
9580 STA VICII+$15 ;TURN ON SPRITE
9590 LDA #$00
9600 PHA ;SET UP COLOR READ
9610 LOOP86 LDX #$0B ;CURSOR Y POS
9620 LDY #$0C ;CURSOR X POS
9630 CLC ;SET FOR PLOT
9640 JSR PLOT ;PLOT CURSOR
9650 PLA
9660 TAX
9670 LDA EGCOLR,X
9680 STA CCOLOR ;SET CURSOR COLOR
9690 STA VICII+$28 ;SET SPRITE COLOR
9700 INX
9710 CPX #$10 ;16 COLORS
9720 BNE LOOP85
9730 LDX #$00
9740 LOOP85 TXA
9750 PHA ;SAVE COLOR READ POSITION
9760 LDX #$00
9770 LOOP81 LDA EGTEXT,X ;GET LETTER
9780 JSR PRINT ;DISPLAY
9790 INX
9800 CPX #$10
9810 BNE LOOP81
9820 LDA #$0C ;MASTER TIME DELAY
9830 LOOP87 PHA
9840 LDA #$00 ;SECONDARY TIME DELAY
9850 LOOP84 PHA
9860 JSR GETIN ;GET CHAR FROM KEYBOARD
9870 CMP #$85 ;F1 KEY
9880 BNE LOOP83
9890 PLA ;GET MASTER TIME DELAY
9900 PLA ;GET TIME DELAY
9910 PLA ;GET COLOR READ
9920 LDA #$00
9930 STA VICII+$1D
9940 JMP REPLAY ;RE-START GAME
9950 LOOP83 PLA ;GET TIME DELAY
9960 TAX
9970 DEX ;COUNT DOWN TO 0
9980 TXA
9990 BNE LOOP84
10000 INC VICII+3 ;MOVE DOWN SCREEN
10010 LDA VICII+3 ;GET G/O SPRITE Y POS
10020 CMP #$F5 ;BOTTOM OF SCREEN?
10030 BNE LOOP88
10040 LDA #$22 ;TOP OF SCREEN
10050 LOOP88 STA VICII+3
10060 PLA
10070 TAX
10080 DEX ;COUNT DOWN TO 0
10090 TXA
10100 BNE LOOP87
10110 JMP LOOP86
10120 ;
10130 ;TITLE SCREEN
10140 ;
10150 TITLE LDA #$00 ;BORDER COLOR
10160 STA VICII+$20
10170 STA VICII+$21
10180 LDA #$0E ;LT. BLUE
10190 STA CCOLOR ;SET CURSOR COLOR
10200 LDA #$93 ;CLEAR SCREEN
10210 JSR PRINT
10220 LDA #$57 ;TOP LEFT CORNER
10230 STA SCREEN
10240 LDA #$58 ;TOP RIGHT CORNER
10250 STA SCREEN+$27
10260 LDA #$59 ;BOTTOM LEFT CORNER
10270 STA SCREEN+$3C0
10280 LDA #$5A ;BOTTOM RIGHT CORNER
10290 STA SCREEN+$3E7
10300 LDX #$00 ;DRAW TOP AND BOTTOM LINES
10310 LOOP90 LDA #$5D ;TOP LINE
10320 STA SCREEN+$01,X
10330 LDA #$5E ;BOTTOM LINE
10340 STA SCREEN+$3C1,X
10350 INX
10360 CPX #$26 ;38 CHARS
10370 BNE LOOP90
10380 LDA #>SCREEN ;GET MSB OF SCREEN MEM
10390 STA INDEX+1
10400 LDA #$28
10410 STA INDEX ;SECOND LINE FROM TOP
10420 LDX #$17 ;24 LINES
10430 LOOP91 LDY #$00
10440 LDA #$5B ;LEFT LINE
10450 STA (INDEX),Y
10460 LDY #$27
10470 LDA #$5C ;RIGHT LINE
10480 STA (INDEX),Y
10490 CLC
10500 LDA INDEX
10510 ADC #$28
10520 STA INDEX
10530 LDA INDEX+1
10540 ADC #$00 ;ADD CARRY
10550 STA INDEX+1
10560 DEX
10570 BNE LOOP91
10580 LDX #$00 ;PRINT TITLE INFO
10590 LOOP93 LDA TTEXT,X
10600 BNE LOOP92 ;PRINT OR PLOT? 0=PLOT
10610 INX
10620 LDA TTEXT,X
10630 PHA
10640 INX
10650 LDA TTEXT,X
10660 STX INDEX
10670 TAY
10680 PLA
10690 TAX
10700 CLC
10710 JSR PLOT ;PLOT CURSOR
10720 LDX INDEX
10730 INX
10740 JMP LOOP93
10750 LOOP92 JSR PRINT
10760 INX
10770 CPX #$C9
10780 BNE LOOP93
10790 LOOP94 JSR GETIN ;CHECK FOR F1 KEY
10800 CMP #$85
10810 BNE LOOP94
10820 RTS
10830 ;
10840 ;VARIABLES AND DATA USED BY SUBROUTINES
10850 ;
10860 RTSCN .BYTE 0 ;IRQ ROUTINE SCANER
10870 RTNUM .BYTE 0,0,0,0 ;ZERO ALL 4 REGS
10880 COLREG .BYTE 0 ;STORAGE FOR SPRITE TO SPRITE COLLISION REG
10890 MLOOP .BYTE 0 ;MISSLE LOOP
10900 TNKEXP .BYTE 0 ;TANK EXPLODING?
10910 FIRTGL .BYTE 0 ;MISSLE FIERED? 0=NO 1=YES
10920 NUMTNK .BYTE 0 ;# OF TANKS LEFT
10930 LEVEL .BYTE 0
10940 UFODIR .BYTE 0 ;DIRECTION OF UFO USED IN INITILIZATION
10950 XPOS .BYTE 0 ;X POSITION OF UFO USED IN INITILIZATION
10960 YPOS .BYTE 0 ;Y POSITION OF UFO USED IN INITILIZATION
10970 INITU1 .BYTE 0 ;UFO1 INITILIZED? 0=NO 1=YES
10980 U1DIR .BYTE 0 ;DIRECTION OF UFO1
10990 BD1 .BYTE 0 ;BOMB1 DROPED?
11000 INITU2 .BYTE 0 ;UFO2 INITILIZED?
11010 U2DIR .BYTE 0 ;UFO2 DIRECTION
11020 BD2 .BYTE 0 ;BOMB2 DROPED?
11030 INITB1 .BYTE 0 ;BOMB1 INITILIZED?
11040 B1FREQ .BYTE 0 ;BOMB1 FREQ
11050 INITB2 .BYTE 0 ;BOMB2 INITILIZED?
11060 B2FREQ .BYTE 0 ;BOMB2 FREQ
11070 EXPFRQ .BYTE 0 ;UFO EXPLOSION FREQ
11080 TNKSND .BYTE 0 ;TANK EXPLOSION FREQ
11090 SC .BYTE 0,0,0 ;6 DIGIT SCORE
11100 TIMER1 .BYTE 0,11,12,11,12,15,12,15,1
11110 TIMER2 .BYTE 0,$16,$16,$15,$15,$14,$14
11120 TIMER3 .BYTE 0,$16,$16,$16,$16,$16,$15,$15,$15,$15,$15,$14,$14,$14,$14,$14
11130 EXPCLR .BYTE 0,$11,$11,$12,$12,$15,$15,$01,$01,$0A,$0A,$02,$0A,$02,$0A,$02
11140 NAME .BYTE 'CHRSPR.DAT'
11150 SDATA .BYTE $93,$05,'SCORE:000000',$9F,' LEVEL:1',$1E,' TANKS:',$C8,$C8,$C8
11160 SPRTBL .BYTE $10,$11,$12,$12,$13,$13,$14,$14
11170 SPCOLR .BYTE $05,$01,$04,$0E,$01,$01,$01,$01
11180 EGTEXT .BYTE 'PRESS F1 TO PLAY'
11190 EGCOLR .BYTE $09,$02,$08,$0A,$01,$05,$0D,$01,$06,$0E,$03,$01,$0B,$0C,$0F
11200 .BYTE $01
11210 TTEXT .BYTE 0,3,12,96,97,98,99,100,101,102,103,103,103,102,101,100,99,98
11220 .BYTE 97,96,0,4,12,105,106,107,107,117,109,32,110,109,106,32,106,108,108
11230 .BYTE 106,105,111,0,5,12,112,113,110,110,117,114,32,113,115,113,32
11240 .BYTE 116,117,117,116,112,118,0,6,12,103,102,101,100,99,98,97,96,96,96
11250 .BYTE 97,98,99,100,101,102,103,0,9,15,150,'V1.0/100186'
11260 .BYTE 0,12,11,5,172,' 1986 '
11270 .BYTE 127,160,161,162,163,164,165,166,167,168,169,170,171
11280 .BYTE 0,15,2,159,'YOU ARE BEING INVADED BY THE COMMIES'
11290 .BYTE 0,18,11,'CAN YOU STOP THEM?',0,21,11,05,'PRESS F1 TO START'
11300 .END
